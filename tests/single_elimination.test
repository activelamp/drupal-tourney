<?php
class SingleElimimationTestCase extends TourneyWebTestCase {
  protected $controller = 'SingleEliminationController';
  
  /**
   * Test info.
   */
  public static function getInfo() {
    return array(
      'name' => t('Single Elimination Tournament'),
      'description' => t('Steps through setting up a single elimination tournament and playing all the way through.'),
      'group' => t('Tourney'),
    );
  }
  
  /**
   * Testing 4 contestants
   */
  public function testSingleElim4() {
    // Create the tournament.
    $tournament_name = $this->createTourney($this->controller, 4);
        
    // Set contestants of the First Match as same user.
    $edit = array();
    // Match 1 Slot 1
    $edit['contestant1'] = 'user.3';
    // Match 1 Slot 2
    $edit['contestant2'] = 'user.3';
    // Save Match 1
    $this->drupalPost('tourney/match/1/edit', $edit, t('Save'));
    // Confirm Tourney Module can't set the same user twice.
    $this->assertRaw(t('Contestant 1 and Contestant 2 cannot be the same person'));
    
    // Now change contestant 2 to a different user.
    // Match 1 Slot 2.
    $edit['contestant2'] = 'user.6';
    // Save Match 1 (/tourney/match/1)
    $this->drupalPost('tourney/match/1/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    // Make sure the link to Tourament is present.
    $this->assertLink(t('Go to tournament !tournament', array('!tournament' => $tournament_name)));
    
    // Play First Match, 'contestant1' (Slot 1 or 'user.3') wins in match 1.
    $edit = array();
    $this->drupalPost('tourney/match/1', $edit, t('Win'), array(), array(), 'tourney-game-win-form');
    // Check to see if winner was successfully set passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.3'));
    
    // Set contestants of the Second Match.
    $edit = array();
    // Match 2 Slot 1
    $edit['contestant1'] = 'user.4';
    // Match 2 Slot 2
    $edit['contestant2'] = 'user.5';
    // Save Match 2 (/tourney/match/2)
    $this->drupalPost('tourney/match/2/edit', $edit, t('Save'));
    // Make sure Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Second Match, 'contestant2' (Slot 2 or 'User.5') wins in Match 2.
    $edit = array();
    $this->drupalPost('tourney/match/2', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.5'));
    
    // Play Third Match, 'contestant2' (Slot 2 or 'User.5') wins in match 3.
    $edit = array();
    $this->drupalPost('tourney/match/3', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner users of previous matches are being passed into this game correctly
    $this->assertRaw('<tr class="odd"><td>user.3</td>');
    $this->assertRaw('<tr class="even"><td>user.5</td>');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    
    // Checking 4 man Tourney Winner is displaying on the Tournament page (Tournament 1)
    $edit = array();
    $this->drupalGet('tourney/tournament/1');
    // Check to see if the winner is printed on the page.
    $this->assertRaw('<div class="field-label">Winner:</div><div class="field-content">user.5</div>');
    // End of 4 Man Tourney
    $this->pass("End of 4 Man Single Elimination Tournament ");
  }
  
  /**
   * Testing 5 contestants
   */
  public function testSingleElim5() {
    // Create the tournament.
    $this->createTourney($this->controller, 5);
    
    // Set contestants of the First Match as same user.
    $edit = array();
    // Match 1 Slot 1
    $edit['contestant1'] = 'user.6';
    // Match 1 Slot 2.
    $edit['contestant2'] = 'user.7';
    // Save Match 1 (/tourney/match/1)
    $this->drupalPost('tourney/match/1/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play First Match
    $edit = array();
    $this->drupalPost('tourney/match/1', $edit, t('Win'), array(), array(), 'tourney-game-win-form');
    // Check to see if winner was successfully set passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.6'));
    
    // Set contestants of the Second Match.
    $edit = array();
    // Match 2 Slot 2
    // Check to see if winner of previous match is being passed into this match correctly to Match 2 Slot 2
    $this->drupalGet('tourney/match/2');
    $this->assertRaw(t('<tr class="odd"><td>user.6</td>'));
    // Match 2 Slot 1
    $edit['contestant1'] = 'user.3';
    // Save Match 2 (/tourney/match/2)
    $this->drupalPost('tourney/match/2/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Second Match
    $edit = array();
    $this->drupalPost('tourney/match/2', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.6'));
    
    // Set contestants of the Third Match.
    $edit = array();
    // Match 3 Slot 1
    $edit['contestant1'] = 'user.4';
    // Match 3 Slot 2
    $edit['contestant2'] = 'user.5';
    // Save Match 3 (/tourney/match/3)
    $this->drupalPost('tourney/match/3/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Third Match
    $edit = array();
    $this->drupalPost('tourney/match/3', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.5'));
    
    // Play Forth Match
    $edit = array();
    $this->drupalPost('tourney/match/4', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner users of previous matches are being passed into this match correctly
    $this->assertRaw('<tr class="odd"><td>user.6</td>');
    $this->assertRaw('<tr class="even"><td>user.5</td>');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    
    // Checking 5 man Tourney Winner is displaying on the Tournament page
    $edit = array();
    $this->drupalGet('tourney/tournament/1');
    // Check to see if the winner is printed on the page.
    $this->assertRaw('<div class="field-label">Winner:</div><div class="field-content">user.5</div>');
    // End of 5 Man Tourney
    $this->pass("End of 5 Man Single Elimination Tournament ");
  }
  
  /**
   * Testing 6 contestants
   */
  public function testSingleElim6() {
    // Create the tournament.
    $this->createTourney($this->controller, 6);
    
    $edit = array();
    // Match 1 Slot 1
    $edit['contestant1'] = 'user.6';
    // Match 1 Slot 2.
    $edit['contestant2'] = 'user.7';
    // Save Match 1 (/tourney/match/1)
    $this->drupalPost('tourney/match/1/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play First Match
    $edit = array();
    $this->drupalPost('tourney/match/1', $edit, t('Win'), array(), array(), 'tourney-game-win-form');
    // Check to see if winner was successfully set passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.6'));
    
    // Set contestants of the Second Match.
    $edit = array();
    // Match 2 Slot 1
    $edit['contestant1'] = 'user.3';
    $edit['contestant2'] = 'user.4';
    $this->drupalPost('tourney/match/2/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Second Match
    $edit = array();
    $this->drupalPost('tourney/match/2', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.4'));
    
    // Set contestants of the Third Match.
    $edit = array();
    // Match 3 Slot 1
    $edit['contestant1'] = 'user.5';
    $this->drupalPost('tourney/match/3/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Third Match
    $edit = array();
    $this->drupalPost('tourney/match/3', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check slot 2 winner, same winner as the winner from tourney/match/1
    $this->assertRaw(t('user.6'));
    
    // Set contestants of the Fourth Match.
    $edit = array();
    // Match 4 Slot 1
    $edit['contestant1'] = 'user.8';
    $this->drupalPost('tourney/match/4/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    // Play Fourth Match
    $edit = array();
    $this->drupalPost('tourney/match/4', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page. Should be winner of match 2.
    $this->assertRaw(t('user.4'));
    

    // Match 5
    // Check to see if winner of previous match is being passed into this match correctly 
    $this->drupalGet('tourney/match/5');
    $this->assertRaw(t('<tr class="odd"><td>user.6</td>'));
    $this->assertRaw(t('<tr class="even"><td>user.4</td>'));
    
    // Play Fifth Match
    $edit = array();
    $this->drupalPost('tourney/match/5', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.4'));
    
    // Checking 6 man Tourney Winner is displaying on the Tournament page
    $edit = array();
    $this->drupalGet('tourney/tournament/1');
    // Check to see if the winner is printed on the page.
    $this->assertRaw('<div class="field-label">Winner:</div><div class="field-content">user.4</div>');
    // End of 6 Man Tourney
    $this->pass("End of 6 Man Single Elimination Tournament ");
  }

  /**
   * Testing 7 contestants
   */
  public function testSingleElim7() {
    // Create the tournament.
    $this->createTourney($this->controller, 7);
    
    $edit = array();
    // Match 1 Slot 1
    $edit['contestant1'] = 'user.6';
    // Match 1 Slot 2.
    $edit['contestant2'] = 'user.7';
    // Save Match 1 (/tourney/match/1)
    $this->drupalPost('tourney/match/1/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play First Match
    $edit = array();
    $this->drupalPost('tourney/match/1', $edit, t('Win'), array(), array(), 'tourney-game-win-form');
    // Check to see if winner was successfully set passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.6'));
    
    // Set contestants of the Second Match.
    $edit = array();
    // Match 2 Slot 1
    $edit['contestant1'] = 'user.4';
    $edit['contestant2'] = 'user.9';
    $this->drupalPost('tourney/match/2/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Second Match
    $edit = array();
    $this->drupalPost('tourney/match/2', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.9'));
    
    // Set contestants of the Third Match.
    $edit = array();
    // Match 3 Slot 1
    $edit['contestant1'] = 'user.5';
    $edit['contestant2'] = 'user.8';
    $this->drupalPost('tourney/match/3/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Third Match
    $edit = array();
    $this->drupalPost('tourney/match/3', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.8'));
    
    // Set contestants of the Fourth Match.
    $edit = array();
    // Match 4 Slot 1
    $edit['contestant1'] = 'user.3';
    $this->drupalPost('tourney/match/4/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Fourth Match
    $edit = array();
    $this->drupalPost('tourney/match/4', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check slot 2 winner, same winner as the winner from tourney/match/1
    $this->assertRaw(t('user.6'));
    
    // Match 5
    // Check to see if winner of previous match is being passed into this match correctly 
    $this->drupalGet('tourney/match/5');
    $this->assertRaw(t('<tr class="odd"><td>user.9</td>'));
    $this->assertRaw(t('<tr class="even"><td>user.8</td>'));
    
    // Play Fifth Match
    $edit = array();
    $this->drupalPost('tourney/match/5', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.8'));
    

    // Match 6
    // Check to see if winner of previous match is being passed into this match correctly 
    $this->drupalGet('tourney/match/6');
    $this->assertRaw(t('<tr class="odd"><td>user.6</td>'));
    $this->assertRaw(t('<tr class="even"><td>user.8</td>'));
    
    // Play Sixth Match
    $edit = array();
    $this->drupalPost('tourney/match/6', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.8'));
    
    // Checking 7 man Tourney Winner is displaying on the Tournament page
    $edit = array();
    $this->drupalGet('tourney/tournament/1');
    // Check to see if the winner is printed on the page.
    $this->assertRaw('<div class="field-label">Winner:</div><div class="field-content">user.8</div>');
    // End of 6 Man Tourney
    $this->pass("End of 7 Man Single Elimination Tournament ");
  }
  
  /**
   * Testing 8 contestants
   */
  public function testSingleElim8() {
    // Create the tournament.
    $this->createTourney($this->controller, 8);
    
    $edit = array();
    // Match 1 Slot 1
    $edit['contestant1'] = 'user.3';
    // Match 1 Slot 2.
    $edit['contestant2'] = 'user.10';
    // Save Match 1 (/tourney/match/1)
    $this->drupalPost('tourney/match/1/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play First Match
    $edit = array();
    $this->drupalPost('tourney/match/1', $edit, t('Win'), array(), array(), 'tourney-game-win-form');
    // Check to see if winner was successfully set passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.3'));
    
    // Set contestants of the Second Match.
    $edit = array();
    // Match 2 Slot 1
    $edit['contestant1'] = 'user.6';
    $edit['contestant2'] = 'user.7';
    $this->drupalPost('tourney/match/2/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Second Match
    $edit = array();
    $this->drupalPost('tourney/match/2', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.7'));
    
    // Set contestants of the Third Match.
    $edit = array();
    // Match 3 Slot 1
    $edit['contestant1'] = 'user.4';
    $edit['contestant2'] = 'user.9';
    $this->drupalPost('tourney/match/3/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Third Match
    $edit = array();
    $this->drupalPost('tourney/match/3', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.9'));

    // Set contestants of the Fourth Match.
    $edit = array();
    // Match 3 Slot 1
    $edit['contestant1'] = 'user.5';
    $edit['contestant2'] = 'user.8';
    $this->drupalPost('tourney/match/4/edit', $edit, t('Save'));
    // Confirm Match has been saved.
    $this->assertRaw(t('Your match has been saved'));
    
    // Play Fourth Match
    $edit = array();
    $this->drupalPost('tourney/match/4', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if winner was successfully set, passing in "Players moved to next round" text.
    $this->assertRaw(t('Players moved to next round'));
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.8'));
    
    // Match 5
    // Check to see if winner of previous match is being passed into this match correctly 
    $this->drupalGet('tourney/match/5');
    $this->assertRaw(t('<tr class="odd"><td>user.3</td>'));
    $this->assertRaw(t('<tr class="even"><td>user.7</td>'));
    
    // Play Fifth Match
    $edit = array();
    $this->drupalPost('tourney/match/5', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.7'));
    
    // Match 6
    // Check to see if winner of previous match is being passed into this match correctly 
    $this->drupalGet('tourney/match/6');
    $this->assertRaw(t('<tr class="odd"><td>user.9</td>'));
    $this->assertRaw(t('<tr class="even"><td>user.8</td>'));
    
    // Play Sixth Match
    $edit = array();
    $this->drupalPost('tourney/match/6', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.8'));
    

    // Match 7
    // Check to see if winner of previous match is being passed into this match correctly 
    $this->drupalGet('tourney/match/7');
    $this->assertRaw(t('<tr class="odd"><td>user.7</td>'));
    $this->assertRaw(t('<tr class="even"><td>user.8</td>'));
    
    // Play Seventh Match
    $edit = array();
    $this->drupalPost('tourney/match/6', $edit, t('Win'), array(), array(), 'tourney-game-win-form--2');
    // Check to see if the winner is printed on the page.
    $this->assertRaw(t('user.8'));
    
    // Checking 8 man Tourney Winner is displaying on the Tournament page
    $edit = array();
    $this->drupalGet('tourney/tournament/1');
    // Check to see if the winner is printed on the page.
    $this->assertRaw('<div class="field-label">Winner:</div><div class="field-content">user.8</div>');
    // End of 8 Man Tourney
    $this->pass("End of 8 Man Single Elimination Tournament ");
  }
}